<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>הכנה לכיתה א' - נעה כהן מרפאה בעיסוק</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="assets/images/logo.jpg" alt="נעה כהן - מרפאה בעיסוק" style="width: 180%; height: 180%; object-fit: contain;">            </div>
            <h1>ברוכים הבאים לכיתה א'!</h1>
            <p>כלי דיגיטלי להכנה רגשית וחווייתית לכיתה א'</p>
        </div>

        <div class="main-content">
            <div class="main-tabs">
                <button class="main-tab active" onclick="showTab('home')">🏠 בית</button>
                <button class="main-tab" onclick="showTab('school')">🏫 בית ספר</button>
                <button class="main-tab" onclick="showTab('memory')">🧠 זיכרון</button>
                <button class="main-tab" onclick="showTab('executive')">🎯 תפקודים</button>
                <button class="main-tab" onclick="showTab('emotions')">💖 רגשות</button>
                <button class="main-tab" onclick="showTab('social')">🤝 חברתי</button>
                <button class="main-tab" onclick="showTab('backpack')">🎒 תרמיל רגשי</button>
            </div>

            <!-- Tab contents will be loaded here -->
            <div class="tabs-container">
                <div id="home" class="tab-content"></div>
                <div id="school" class="tab-content"></div>
                <div id="memory" class="tab-content"></div>
                <div id="executive" class="tab-content"></div>
                <div id="emotions" class="tab-content"></div>
                <div id="social" class="tab-content"></div>
                <div id="backpack" class="tab-content"></div>
            </div>
        </div>
    </div>

    <!-- Main JavaScript -->
    <script src="assets/js/app.js"></script>
    
    <!-- Component Loader -->
    <script>
        // Global variables
        let strengths = [];
        let challenges = [];
        let helpItems = [];
        let gradeEmotions = [];
        let savedThoughts = {
            exciting: '',
            scary: '',
            happy: '',
            sad: ''
        };

        // Load components when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Load tab contents
            // Load all components first, then show the tab
            Promise.all([
                loadComponent('home', 'home-tab.html'),
                loadComponent('school', 'school-tab.html'),
                loadComponent('memory', 'memory-tab.html'),
                loadComponent('executive', 'executive-tab.html'),
                loadComponent('emotions', 'emotions-tab.html'),
                loadComponent('social', 'social-tab.html'),
                loadComponent('backpack', 'backpack-tab.html'),
                // Load footer
                fetch('assets/components/footer.html')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Failed to load footer: ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(html => {
                        const footer = document.createElement('footer');
                        footer.innerHTML = html;
                        document.body.appendChild(footer);
                    })
            ])
            .then((results) => {
                console.log('All components loaded successfully:', results);
                try {
                    const lastActiveTab = localStorage.getItem('lastActiveTab') || 'home';
                    console.log('Showing tab:', lastActiveTab);
                    showTab(lastActiveTab);
                } catch (tabError) {
                    console.error('Error showing tab:', tabError);
                    showTab('home');
                }
            })
            .catch(error => {
                console.error('Error in component loading sequence:', error);
                console.error('Error details:', {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                });
                // Show error to user
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'background: #ffebee; color: #c62828; padding: 20px; margin: 20px; border-radius: 8px; text-align: center;';
                errorDiv.innerHTML = `
                    <h3>אירעה שגיאה בטעינת האפליקציה</h3>
                    <p>אנא רענן את הדף או נסה שוב מאוחר יותר.</p>
                    <small>${error.message}</small>
                `;
                document.querySelector('.main-content').prepend(errorDiv);
                showTab('home');
            });
        });
        
        /**
         * Load a component into the specified element
         * @param {string} elementId - ID of the element to load into
         * @param {string} fileName - Name of the component file
         */
        function loadComponent(elementId, fileName) {
            const filePath = `assets/components/${fileName}`;
            console.log(`Loading component: ${filePath}`);
            
            return fetch(filePath)
                .then(response => {
                    console.log(`Response for ${fileName}:`, response.status, response.statusText);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(html => {
                    console.log(`Successfully loaded ${fileName}`);
                    const element = document.getElementById(elementId);
                    if (!element) {
                        throw new Error(`Element with ID '${elementId}' not found`);
                    }
                    
                    element.innerHTML = html;
                    console.log(`Injected HTML for ${elementId}`);
                    
                    // Initialize components if available
                    if (typeof initComponents === 'function') {
                        try {
                            console.log(`Initializing components for ${elementId}`);
                            initComponents();
                        } catch (e) {
                            console.error(`Error in initComponents for ${elementId}:`, e);
                            throw e; // Re-throw to be caught by the outer catch
                        }
                    }
                    return true; // Indicate success
                })
                .catch(error => {
                    console.error(`Failed to load component ${fileName} into ${elementId}:`, error);
                    throw error; // Re-throw to be caught by Promise.all
                });
        }
        
        /**
         * Show the selected tab and hide others
         * @param {string} tabId - ID of the tab to show
         */
        function showTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Deactivate all tab buttons
            document.querySelectorAll('.main-tab').forEach(tabBtn => {
                tabBtn.classList.remove('active');
            });
            
            // Show the selected tab content
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.add('active');
                
                // Activate the clicked tab button
                const tabButtons = document.querySelectorAll('.main-tab');
                tabButtons.forEach(btn => {
                    if (btn.getAttribute('onclick').includes(tabId)) {
                        btn.classList.add('active');
                    }
                });
                
                // Save the current tab
                localStorage.setItem('lastActiveTab', tabId);
                
                // Scroll to top
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            }
        }
        
        // Load last active tab if available
        const lastActiveTab = localStorage.getItem('lastActiveTab');
        if (lastActiveTab) {
            showTab(lastActiveTab);
        }
    </script>
</body>
</html>
